<div class="container mx-auto p-4 md:p-8 max-w-[1200px] font-sans text-gray-800 leading-[1.8]">
  <div #cvContainer class="bg-white rounded-lg overflow-hidden grid grid-cols-1 md:grid-cols-4 main-container-border">
    
    <!-- Left Column (Sidebar) -->
    @if (isSidebarVisible()) {
      <aside class="md:col-span-1 bg-gray-800 text-white p-8 animate-fade-in">
        <div class="flex flex-col items-center md:items-start">
          <img [src]="profilePicture()" alt="Profilbild David Castillo" class="rounded-lg w-48 mx-auto md:w-full md:mx-0 border border-gray-300 mb-6">
          <h1 class="text-4xl font-bold text-center md:text-left">{{ name() }}</h1>
          <h2 (click)="togglePdfButtonVisibility()" class="text-xl font-light text-blue-300 mt-2 text-center md:text-left cursor-pointer hover:text-blue-200 transition">{{ title() }}</h2>
        </div>

        <div class="mt-10">
          <h3 class="text-lg font-semibold border-b border-gray-600 pb-2 mb-4 uppercase tracking-wider">Kontakt</h3>
          <ul class="space-y-3 text-base">
            <li class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-300" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg>
              <span>{{ contact().phone }}</span>
            </li>
            <li class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-300" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" /><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" /></svg>
              <a href="mailto:{{ contact().email }}" class="hover:text-blue-300">{{ contact().email }}</a>
            </li>
            <li class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-300" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
              <a href="{{ contact().github }}" target="_blank" rel="noopener noreferrer" class="hover:text-blue-300">github.com/Davidcastmed</a>
            </li>
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 mt-1 flex-shrink-0 text-blue-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>
              <span>{{ contact().address }}</span>
            </li>
          </ul>
        </div>

        <div class="mt-10">
          <h3 class="text-lg font-semibold border-b border-gray-600 pb-2 mb-4 uppercase tracking-wider">Persönliche Daten</h3>
          <ul class="space-y-3 text-base">
            <li class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-300" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
              </svg>
              <span>Geboren: {{ personalInfo().dateOfBirth }}</span>
            </li>
            <li class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-300" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.72 7.97 5 10 5c2.03 0 3.488.72 3.756 1.321l.007.02.007.019a.75.75 0 01-1.32.495l-.008-.022-.007-.019a4.506 4.506 0 00-2.426-.823 4.503 4.503 0 00-2.427.823.498.498 0 01-.67-.223zM10 15c-2.03 0-3.488-.72-3.756-1.321l-.007-.02-.007-.019a.75.75 0 111.32-.495l.008.022.007.019a4.506 4.506 0 012.426.823 4.503 4.503 0 012.427-.823.498.498 0 01.67.223z" clip-rule="evenodd" />
              </svg>
              <span>Nationalität: {{ personalInfo().nationality }}</span>
            </li>
          </ul>
        </div>

        <div class="mt-10">
          <h3 class="text-lg font-semibold border-b border-gray-600 pb-2 mb-4 uppercase tracking-wider">Sprachen</h3>
          <ul class="space-y-2 text-base">
            @for (lang of languages(); track lang.lang) {
              <li>
                <p class="font-medium">{{ lang.lang }}</p>
                <p class="text-gray-400">{{ lang.level }}</p>
              </li>
            }
          </ul>
        </div>

        <div class="mt-10">
          <h3 class="text-lg font-semibold border-b border-gray-600 pb-2 mb-4 uppercase tracking-wider">Hobbys</h3>
          <div class="flex flex-wrap gap-2 text-base">
              @for (hobby of hobbies(); track hobby) {
                <span class="bg-gray-700 text-gray-300 text-sm px-2.5 py-1 rounded-[3px]">{{ hobby }}</span>
              }
          </div>
        </div>
      </aside>
    }

    <!-- Right Column (Main Content) -->
    <main class="p-4 sm:p-8 overflow-y-auto" [class.md:col-span-3]="isSidebarVisible()" [class.md:col-span-4]="!isSidebarVisible()">
      
      <!-- Sticky Header -->
      <div class="sticky top-[60px] md:top-0 bg-white/90 backdrop-blur-sm z-10 -mx-4 sm:-mx-8 px-4 sm:px-8 -mt-4 sm:-mt-8 pt-6 pb-4 mb-6 pdf-exclude">
          <div class="flex items-center min-h-[48px]">
            <!-- Mobile Header -->
            <div class="flex md:hidden items-center justify-between w-full animate-fade-in">
              <div>
                <h1 class="text-xl font-bold text-gray-800">{{ name() }}</h1>
                <h2 (click)="togglePdfButtonVisibility()" class="text-md font-light text-blue-600 -mt-1 cursor-pointer hover:text-blue-800 transition">{{ title() }}</h2>
              </div>
              @if (isPdfButtonVisible()) {
                <button (click)="downloadAsPdf(cvContainer)" [disabled]="isLoadingPdf()" class="text-gray-600 hover:text-blue-600 p-2 rounded-full disabled:text-gray-300 animate-fade-in">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                </button>
              }
            </div>

            <!-- Desktop Header -->
            <div class="hidden md:flex items-center w-full">
              @if (isSidebarVisible()) {
                  <button (click)="toggleSidebar()" class="bg-gray-700 text-white px-4 py-2 rounded-full flex items-center space-x-2 hover:bg-gray-600 transition-colors duration-300">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                      </svg>
                      <span>Vollansicht</span>
                  </button>
              } @else {
                  <div class="flex justify-between items-center w-full animate-fade-in">
                      <div class="flex items-center space-x-2 md:space-x-4">
                          <button (click)="toggleSidebar()" class="bg-gray-700 text-white p-2 md:px-4 md:py-2 rounded-full flex items-center space-x-0 md:space-x-2 hover:bg-gray-600 transition-colors duration-300">
                              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                              </svg>
                              <span class="hidden md:inline font-semibold">Profil anzeigen</span>
                          </button>
                          <div>
                              <h1 class="text-lg font-bold text-gray-800">{{ name() }}</h1>
                              <h2 (click)="togglePdfButtonVisibility()" class="text-sm font-light text-blue-600 -mt-1 cursor-pointer hover:text-blue-800 transition">{{ title() }}</h2>
                          </div>
                      </div>
                  </div>
              }
              @if (isPdfButtonVisible()) {
                <button (click)="downloadAsPdf(cvContainer)" [disabled]="isLoadingPdf()" class="ml-auto bg-blue-600 text-white px-4 py-2 rounded-full flex items-center space-x-2 hover:bg-blue-700 transition-colors duration-300 disabled:bg-blue-400 disabled:cursor-not-allowed animate-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                    <span>PDF Herunterladen</span>
                </button>
              }
            </div>
          </div>
      </div>

      <section>
        <div class="flex flex-col md:flex-row gap-8 p-4 sm:p-6 bg-gray-50 rounded-lg border border-gray-200 items-start">
            
            <!-- Photo Column -->
            @if (!isSidebarVisible()) {
              <div class="flex-shrink-0 w-full md:w-52 text-center md:order-last animate-fade-in">
                  <img [src]="profilePicture()" alt="Profilbild David Castillo" class="rounded-lg w-full max-w-[208px] mx-auto border-2 border-white shadow-lg">
                  <h1 class="text-2xl font-bold text-gray-800 mt-4">{{ name() }}</h1>
                  <h2 (click)="togglePdfButtonVisibility()" class="text-lg font-light text-blue-600 cursor-pointer hover:text-blue-800 transition">{{ title() }}</h2>
              </div>
            }
            
            <!-- Info Grid -->
            <div class="flex-grow grid grid-cols-1 sm:grid-cols-2 gap-8">
              <!-- Column 1 -->
              <div class="space-y-8">
                  <!-- Kontakt -->
                  <div>
                      <h4 class="text-xl font-semibold text-gray-800 mb-4">Kontakt</h4>
                      <ul class="space-y-3 text-base text-gray-700">
                        <li class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg><span>{{ contact().phone }}</span></li>
                        <li class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" /><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" /></svg><a href="mailto:{{ contact().email }}" class="hover:text-blue-600">{{ contact().email }}</a></li>
                        <li class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-600" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg><a href="{{ contact().github }}" target="_blank" rel="noopener noreferrer" class="hover:text-blue-600">github.com/Davidcastmed</a></li>
                        <li class="flex items-start"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 mt-1 flex-shrink-0 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg><span>{{ contact().address }}</span></li>
                      </ul>
                  </div>
                  <!-- Sprachen -->
                  <div>
                      <h4 class="text-xl font-semibold text-gray-800 mb-4">Sprachen</h4>
                      <ul class="space-y-2 text-base">
                        @for (lang of languages(); track lang.lang) {
                          <li>
                            <p class="font-medium text-gray-800">{{ lang.lang }}</p>
                            <p class="text-gray-500">{{ lang.level }}</p>
                          </li>
                        }
                      </ul>
                  </div>
              </div>

              <!-- Column 2 -->
              <div class="space-y-8">
                  <!-- Persönliche Daten -->
                  <div>
                      <h4 class="text-xl font-semibold text-gray-800 mb-4">Persönliche Daten</h4>
                      <ul class="space-y-3 text-base text-gray-700">
                        <li class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg><span>Geboren: {{ personalInfo().dateOfBirth }}</span></li>
                        <li class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.72 7.97 5 10 5c2.03 0 3.488.72 3.756 1.321l.007.02.007.019a.75.75 0 01-1.32.495l-.008-.022-.007-.019a4.506 4.506 0 00-2.426-.823 4.503 4.503 0 00-2.427.823.498.498 0 01-.67-.223zM10 15c-2.03 0-3.488-.72-3.756-1.321l-.007-.02-.007-.019a.75.75 0 111.32-.495l.008.022.007.019a4.506 4.506 0 012.426.823 4.503 4.503 0 012.427-.823.498.498 0 01.67.223z" clip-rule="evenodd" /></svg><span>Nationalität: {{ personalInfo().nationality }}</span></li>
                      </ul>
                  </div>
                  <!-- Hobbys -->
                  <div>
                      <h4 class="text-xl font-semibold text-gray-800 mb-4">Hobbys</h4>
                      <div class="flex flex-wrap gap-2 text-base">
                          @for (hobby of hobbies(); track hobby) {
                            <span class="bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-1 rounded-full">{{ hobby }}</span>
                          }
                      </div>
                  </div>
              </div>
            </div>
        </div>
      </section>

      <section class="mt-8">
        <h3 class="text-2xl font-bold text-gray-800 border-b border-slate-300 pb-2 mb-4 tracking-wide">About me</h3>
        <p class="text-lg text-gray-600">{{ about() }}</p>
      </section>

      <section class="mt-8">
        <h3 class="text-2xl font-bold text-gray-800 border-b border-slate-300 pb-2 mb-6 tracking-wide">Berufserfahrung</h3>
        <div class="space-y-6">
          @for(exp of experiences(); track exp.company) {
            <div>
              <div class="flex flex-col sm:flex-row justify-between sm:items-baseline">
                <h4 class="text-xl font-semibold text-blue-600">{{ exp.role }}</h4>
                <p class="text-sm font-mono text-chiseled mt-1 sm:mt-0">{{ exp.period }}</p>
              </div>
              <p class="text-lg text-gray-700 font-medium">{{ exp.company }}</p>
              @if (exp.subtitle) {
                <p class="text-base text-gray-600 italic -mt-1">{{ exp.subtitle }}</p>
              }
              <ul class="list-disc list-inside mt-2 space-y-1 text-lg text-gray-600">
                @for(desc of exp.description; track desc) {
                  <li>{{ desc }}</li>
                }
              </ul>
              <div class="mt-3 flex flex-wrap gap-2">
                @for(tech of exp.tech; track tech) {
                  <span class="bg-gray-200 text-gray-700 text-sm font-semibold px-2.5 py-1 rounded-[3px]">{{ tech }}</span>
                }
              </div>
            </div>
          }
        </div>
      </section>

      <section class="mt-8">
        <h3 class="text-2xl font-bold text-gray-800 border-b border-slate-300 pb-2 mb-6 tracking-wide">Kenntnisse</h3>
        <div class="space-y-6">
          @for (skill of skills(); track skill.category) {
            <div>
              <h4 class="text-xl font-semibold text-gray-700 mb-3">{{ skill.category }}</h4>
              <div class="space-y-4">
                @for (item of skill.items; track item.name) {
                  <div>
                    <div class="flex justify-between mb-1">
                      <span class="text-base font-medium text-gray-700">{{ item.name }}</span>
                      <span class="text-sm font-medium text-gray-500">{{ item.level }}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                      <div class="bg-blue-600 h-2.5 rounded-full" [style.width.%]="item.level"></div>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </section>

      <section class="mt-8">
        <h3 class="text-2xl font-bold text-gray-800 border-b border-slate-300 pb-2 mb-6 tracking-wide">Bildungsweg</h3>
        <div class="space-y-6">
          @for (edu of education(); track edu.degree) {
            <div>
              <div class="flex flex-col sm:flex-row justify-between sm:items-baseline">
                <h4 class="text-xl font-semibold text-blue-600">{{ edu.degree }}</h4>
                <p class="text-sm font-mono text-chiseled mt-1 sm:mt-0">{{ edu.period }}</p>
              </div>
              <p class="text-lg text-gray-700">
                {{ edu.institution }}
                @if (edu.location) {
                  <span class="text-gray-500"> - {{ edu.location }}</span>
                }
              </p>
              @if (edu.details) {
                <ul class="list-disc list-inside mt-2 space-y-1 text-lg text-gray-600">
                  @for (detail of edu.details; track detail) {
                    <li>{{ detail }}</li>
                  }
                </ul>
              }
            </div>
          }
        </div>
      </section>
    </main>
  </div>
</div>

<!-- PDF Loading Overlay -->
@if (isLoadingPdf()) {
  <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex flex-col items-center justify-center text-white animate-fade-in">
      <svg class="animate-spin h-10 w-10 text-white mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p class="text-lg font-semibold">PDF wird generiert...</p>
      <p class="text-sm text-gray-300">Layout wird für A4 optimiert, bitte warten.</p>
  </div>
}